#!/sbin/msh

setenv USER user
setenv HOME /home/user
setenv SHELL /sbin/cmd

umask 0000
setenv XDG_RUNTIME_DIR /tmp/$USER
mkdir $XDG_RUNTIME_DIR 0700 $USER:$USER
mkdir /tmp/.X11-unix 01777
umask 0022

cd $HOME

setgid $USER
setuid $USER

setenv WESTON_TTY_FD 0
setenv WESTON_LAUNCHER_SOCK 3

waitfor /dev/dri/card0

# Xorg config/udev code does not handle partially-initialized udev
# very well, and is likely to lose some inputs at the very least.
warn "Waiting for udev"
waitfor /run/udev/control 10

warn "Starting X server"
exec /sbin/system/xorgvt
